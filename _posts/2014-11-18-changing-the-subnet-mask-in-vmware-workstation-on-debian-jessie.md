---
layout: post
title: "Changing the subnet mask in Vmware Workstation on Debian Jessie"
date: 2014-11-18 16:50:00 +0200
updated: 2014-11-19 00:50:00 +0200
comments: true
categories: vmware english
---

I'm currently attending  [SANS SEC504: Hacker Tools, Techniques, Exploits and Incident Handling](http://www.sans.org/course/hacker-techniques-exploits-incident-handling) in [London](http://www.sans.org/event/london-2014). For some of the labs in the course we need machines on the IPs 10.10.0.1 and 10.10.71.1 with a subnet mask of 255.255.0.0.</p>

Changing the Subnet Mask for the NAT or host-only networks in VMware Workstation seems like such a easy thing to do. According to VMware it should be as easy as opening the Virtual Network Editor and ["type a new value in the Subnet mask text box"](http://www.webcitation.org/6UA6PodTF).

Oh wait â€¦ I can't change it. The field for subnet mask in the Virtual Network Editor is not editable.

<!-- more -->

![VMware Virtual Network Editor: the field for subnet mask is not editable]({{ "/images/vmware_workstation_subnet_mask_nochange.png" | absolute_url }}){title:"VMware Virtual Network Editor: the field for subnet mask is not editable"}

Let's keep googling - plenty matches, but everyone keeps insisting it can be changed in the GUI, or mixes the subnet mask with the subnet IP. Some posts blame permission, but since the Virtual Network Editor always runs as root, that's not the problem. There are no listings for the vmnets in ```/etc/network/interfaces``` or ```/etc/network/interfaces.d/``` and changing the subnet mask in NetworkManager does nothing.

After a lot of thinking (and just after I checked ```/etc/network/interfaces``` ) I found ```/etc/vmware/networking``` - BINGO! This looks like just the file we were looking for.

Before editing the file we should stop any vmware-related services that might use these files.

```
$ sudo service vm<TAB>
vmamqpd vmware vmware-USBArbitrator vmware-workstation-server
```

I'm not sure witch of these services use the files we are editing, so we'll stop them all

```
$ sudo service vmamqpd
$ sudo service vmware
$ sudo service vmware-USBArbitrator
$ sudo service vmware-workstation-server
```

For the SANS course I have set up a new host-only network vmnet2. Since we are using static IPs, and will be running malware on these systems, I have disabled DHCP and not connected a host virtual adapter. The shared folder option ```Map as a network drive in Windows guests``` still work, don't ask me how. Below is the configuration for vmnet2 with a subnet mask of 255.255.0.0.

```
answer VNET_2_DHCP no
answer VNET_2_DHCP_CFG_HASH E9892EF1006EBB5D4996DF1A377B10EB0D542B94
answer VNET_2_HOSTONLY_NETMASK 255.255.0.0
answer VNET_2_HOSTONLY_SUBNET 10.10.0.0
answer VNET_2_VIRTUAL_ADAPTER no
```

Success! (but continue reading, we update the DHCP configuration below the picture)

![My helpful screenshot]({{ "/images/vmware_workstation_subnet_mask_changed.png" | absolute_url }})

 img center /images/vmware_workstation_subnet_mask_changed.png 'VMware Virtual Network Editor: the uneditable field contains the subnet mask we wanted' 'VMware Virtual Network Editor: the uneditable field contains the subnet mask we wanted'

VMware stores DHCP config and leases in ```/etc/vmware/vmnet<NUM>/dhcpd/```. If we have changed the subnet IP, subnet mask, or turned on or off DHCP, these files need to be updated. The configfile contains autogenerated information surronded by "DO NOT MODIFY SECTION", so we should probably not edit it manually.

If we open VMware Virtual Network Editor (```sudo vmware-netcfg```), change a setting (e.g. the subnet IP from 10.10.0.0 to 10.11.0.0), save, and then change it back again, VMware will update the files for us.
